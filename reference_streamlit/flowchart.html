<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Interactive Flowchart</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

        :root {
            --bg-color: #f4f7fa;
            --node-bg: #ffffff;
            --accent-primary: #007bff;
            --accent-secondary: #6c757d;
            --accent-success: #28a745;
            --text-color: #212529;
            --border-color: #dee2e6;
            --shadow-color: rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 2rem 0;
        }
        
        #instruction-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 100;
            cursor: pointer;
            transition: opacity 0.5s ease;
            opacity: 1;
        }

        .flowchart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding-bottom: 80px;
        }

        .node {
            background: var(--node-bg);
            border: 1px solid var(--border-color);
            padding: 15px 25px;
            border-radius: 12px;
            text-align: center;
            width: 280px;
            position: relative;
            box-shadow: 0 5px 15px var(--shadow-color);
            transition: all 0.4s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
            cursor: pointer;
        }
        
        .node.visible { opacity: 1; transform: translateY(0); }
        .node.active { border-color: var(--accent-primary); box-shadow: 0 0 15px rgba(0, 123, 255, 0.3); }
        .node.start, .node.end { background: var(--accent-primary); color: white; font-weight: 600; }
        .node.decision { background: var(--accent-secondary); color: white; }
        .node.continue { background: var(--accent-success); color: white; }

        .connector { width: 2px; background-color: var(--border-color); position: relative; transition: height 0.4s ease; height: 0; }
        .connector.visible { height: 40px; }
        .connector::after { content: ''; position: absolute; left: 50%; bottom: -1px; transform: translateX(-50%); border-left: 7px solid transparent; border-right: 7px solid transparent; border-top: 9px solid var(--border-color); transition: opacity 0.4s ease; opacity: 0; }
        .connector.visible::after { opacity: 1; }

        .role-paths { display: flex; gap: 40px; align-items: flex-start; }
        .path { display: flex; flex-direction: column; align-items: center; gap: 20px; transition: opacity 0.4s ease; }
        .path.dimmed { opacity: 0.2; pointer-events: none; }
        .path-title { font-weight: 600; color: var(--accent-primary); margin-bottom: 10px; opacity: 0; transition: opacity 0.4s ease; }
        .path-title.visible { opacity: 1; }

        .btn-group { display: none; gap: 15px; margin-top: 15px; }
        .btn-group.visible { display: flex; }

        .btn {
            background-color: var(--node-bg);
            color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .btn:hover, .btn.selected { background-color: var(--accent-primary); color: white; transform: translateY(-2px); }
        .btn:disabled { background-color: #e9ecef; color: #6c757d; border-color: var(--border-color); cursor: not-allowed; }
        .btn.success { color: var(--accent-success); border-color: var(--accent-success); }
        .btn.success:hover { background-color: var(--accent-success); color: white; }
        .btn.danger { color: var(--accent-secondary); border-color: var(--accent-secondary); }
        .btn.danger:hover { background-color: var(--accent-secondary); color: white; }

        #nav-controls { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); padding: 10px; border-radius: 12px; box-shadow: 0 2px 10px var(--shadow-color); z-index: 50; opacity: 0; transition: opacity 0.5s ease; pointer-events: none; }
        #nav-controls.visible { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body>
    <div id="instruction-overlay">
        <h1>Interactive Flowchart</h1>
        <p>Click anywhere to start</p>
    </div>

    <div class="flowchart-container">
        <!-- Nodes will be the same as before -->
        <div id="n-start" class="node start">Start: Smart Resume Screener</div>
        <div id="n-init" class="node process">Initialization</div>
        <div id="n-decision" class="node decision">
            Select Role
            <div id="decision-buttons" class="btn-group">
                <button id="btn-user" class="btn">Normal User</button>
                <button id="btn-admin" class="btn">Admin</button>
            </div>
        </div>
        <div class="role-paths">
            <div id="path-user" class="path">
                <div id="pt-user" class="path-title">Normal User Path</div>
                <div id="n-user-1" class="node process">Upload Resume (PDF)</div>
                <div id="c-user-1" class="connector"></div>
                <div id="n-user-2" class="node process">Extract Text</div>
                <div id="c-user-2" class="connector"></div>
                <div id="n-user-3" class="node process">Parse with Pyresparser</div>
                <div id="c-user-3" class="connector"></div>
                <div id="n-user-4" class="node process">Score Sections & Predict Field</div>
            </div>
            <div id="path-admin" class="path">
                <div id="pt-admin" class="path-title">Admin Path</div>
                <div id="n-admin-1" class="node process">Enter Credentials</div>
                <div id="c-admin-1" class="connector"></div>
                <div id="n-admin-2" class="node process">Fetch All User Data</div>
                <div id="c-admin-2" class="connector"></div>
                <div id="n-admin-3" class="node process">Display Data Table</div>
                <div id="c-admin-3" class="connector"></div>
                <div id="n-admin-4" class="node process">Show Visualizations</div>
            </div>
        </div>
        <div id="n-continue" class="node continue">
            Path Complete!
            <div id="continue-buttons" class="btn-group">
                <button id="btn-continue" class="btn success">Explore Other Role</button>
                <button id="btn-end" class="btn danger">End</button>
            </div>
        </div>
        <div id="n-end" class="node end">End</div>
    </div>
    <div id="nav-controls">
        <button id="prev-btn" class="btn">Previous</button>
        <button id="next-btn" class="btn">Next</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const flowchart = {
                sequence: [
                    ['n-start'],
                    ['n-init'],
                    ['n-decision'],
                ],
                paths: {
                    user: [
                        ['pt-user', 'c-user-1', 'n-user-1'],
                        ['c-user-2', 'n-user-2'],
                        ['c-user-3', 'n-user-3'],
                        ['n-user-4']
                    ],
                    admin: [
                        ['pt-admin', 'c-admin-1', 'n-admin-1'],
                        ['c-admin-2', 'n-admin-2'],
                        ['c-admin-3', 'n-admin-3'],
                        ['n-admin-4']
                    ]
                },
                finalSteps: [
                    ['n-continue'],
                    ['n-end']
                ],
                step: -1,
                pathStep: -1,
                selectedPath: null,
                completedPaths: [],

                init() {
                    this.addEventListeners();
                    this.reset();
                },

                addEventListeners() {
                    document.getElementById('instruction-overlay').addEventListener('click', () => this.start(), { once: true });
                    document.getElementById('next-btn').addEventListener('click', () => this.next());
                    document.getElementById('prev-btn').addEventListener('click', () => this.prev());
                    document.getElementById('btn-user').addEventListener('click', () => this.selectPath('user'));
                    document.getElementById('btn-admin').addEventListener('click', () => this.selectPath('admin'));
                    document.getElementById('btn-continue').addEventListener('click', () => this.switchToOtherPath());
                    document.getElementById('btn-end').addEventListener('click', () => this.endFlow());
                },

                start() {
                    const overlay = document.getElementById('instruction-overlay');
                    overlay.style.opacity = '0';
                    setTimeout(() => { overlay.style.display = 'none'; }, 500);
                    document.getElementById('nav-controls').classList.add('visible');
                    this.next();
                },

                next() {
                    if (this.step < this.sequence.length - 1) {
                        this.step++;
                    } else if (this.selectedPath && this.pathStep < this.paths[this.selectedPath].length - 1) {
                        this.pathStep++;
                    } else if (this.step === this.sequence.length - 1 && this.selectedPath) {
                        this.step++; // Move to the continue/end phase
                    }
                    this.update();
                },

                prev() {
                    if (this.pathStep > -1) {
                        this.pathStep--;
                    } else if (this.step > 0) {
                        this.step--;
                        if(this.selectedPath) { // If we go back from continue, re-enter the path
                            this.pathStep = this.paths[this.selectedPath].length -1;
                            this.completedPaths = this.completedPaths.filter(p => p !== this.selectedPath);
                            this.selectedPath = null;
                        }
                    }
                    this.update();
                },

                update() {
                    this.hideAll();
                    let activeNode = null;

                    for (let i = 0; i <= this.step; i++) {
                        if (i < this.sequence.length) {
                            this.sequence[i].forEach(id => document.getElementById(id).classList.add('visible'));
                            activeNode = this.sequence[i][0];
                        }
                    }

                    if (this.selectedPath) {
                        for (let i = 0; i <= this.pathStep; i++) {
                            this.paths[this.selectedPath][i].forEach(id => document.getElementById(id).classList.add('visible'));
                            activeNode = this.paths[this.selectedPath][i].find(id => id.startsWith('n-'));
                        }
                    }
                    
                    if (this.step > this.sequence.length - 1) {
                        const finalStepIndex = this.step - this.sequence.length;
                        if (this.finalSteps[finalStepIndex]) {
                            this.finalSteps[finalStepIndex].forEach(id => document.getElementById(id).classList.add('visible'));
                            activeNode = this.finalSteps[finalStepIndex][0];
                        }
                    }

                    if (activeNode) document.getElementById(activeNode).classList.add('active');

                    document.getElementById('decision-buttons').classList.toggle('visible', activeNode === 'n-decision' && !this.selectedPath);
                    document.getElementById('continue-buttons').classList.toggle('visible', activeNode === 'n-continue');
                    document.getElementById('btn-continue').disabled = this.completedPaths.length >= 2;
                },

                selectPath(path) {
                    if (this.completedPaths.includes(path)) return;
                    this.selectedPath = path;
                    this.completedPaths.push(path);
                    document.getElementById('path-user').classList.toggle('dimmed', path === 'admin');
                    document.getElementById('path-admin').classList.toggle('dimmed', path === 'user');
                    this.next();
                },
                
                switchToOtherPath() {
                    const otherPath = this.selectedPath === 'user' ? 'admin' : 'user';
                    this.step = this.sequence.findIndex(s => s[0] === 'n-decision');
                    this.pathStep = -1;
                    this.selectedPath = null;
                    this.update();
                    this.selectPath(otherPath);
                },

                endFlow() {
                    this.step = this.sequence.length; // Move past continue
                    this.pathStep = -1;
                    this.next();
                },

                hideAll() {
                    document.querySelectorAll('.node, .connector, .path-title').forEach(el => el.classList.remove('visible', 'active'));
                },

                reset() {
                    this.step = -1; this.pathStep = -1; this.selectedPath = null; this.completedPaths = [];
                    const overlay = document.getElementById('instruction-overlay');
                    overlay.style.display = 'flex';
                    overlay.style.opacity = '1';
                    document.getElementById('nav-controls').classList.remove('visible');
                    this.update();
                }
            };

            flowchart.init();
        });
    </script>
</body>
</html>