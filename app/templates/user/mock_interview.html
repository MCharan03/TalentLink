{% extends "base.html" %}

{% block title %}Mock Interview{% endblock %}

{% block content %}
<div class="container">
    <h1>Mock Interview</h1>
    <div id="chat-box" class="border p-3" style="height: 400px; overflow-y: scroll;">
        <!-- Interview messages will appear here -->
    </div>
    <div class="input-group mt-3">
        <input type="text" id="answer-input" class="form-control" placeholder="Your answer...">
        <button id="send-btn" class="btn btn-primary">Send</button>
    </div>
    <button id="start-btn" class="btn btn-success mt-3">Start Interview</button>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        socket.on('connect', function() {
            console.log('Websocket connected!');
        });

        const chatBox = document.getElementById('chat-box');
        const answerInput = document.getElementById('answer-input');
        const sendBtn = document.getElementById('send-btn');
        const startBtn = document.getElementById('start-btn');

        startBtn.addEventListener('click', () => {
            socket.emit('start_interview', {});
            startBtn.style.display = 'none';
        });

        sendBtn.addEventListener('click', () => {
            const answer = answerInput.value;
            if (answer.trim() !== '') {
                appendMessage('You', answer);
                socket.emit('send_answer', { 'answer': answer });
                answerInput.value = '';
            }
        });

        answerInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });

        socket.on('interview_question', function(data) {
            appendMessage('Interviewer', data.question);
        });

        function appendMessage(sender, message) {
            const messageElement = document.createElement('div');
            messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    });
</script>
{% endblock %}
