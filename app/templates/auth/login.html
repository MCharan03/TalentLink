{% extends "base.html" %}

{% block title %}Login{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5 animate-in">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow border-0">
            <!-- 1. Role Selection (TOP) -->
            <div class="card-header border-0 pt-4 pb-2 text-center">
                <form id="roleToggleForm">
                    <div class="btn-group w-75" role="group" aria-label="Login Role">
                        <input type="radio" class="btn-check" name="role_toggle" id="role-user" value="user" checked onclick="syncRole('user')">
                        <label class="btn btn-outline-primary" for="role-user">Candidate</label>

                        <input type="radio" class="btn-check" name="role_toggle" id="role-admin" value="admin" onclick="syncRole('admin')">
                        <label class="btn btn-outline-primary" for="role-admin">Administrator</label>
                    </div>
                </form>
            </div>

            <!-- 2. Login/Register Tabs (MIDDLE) -->
            <div class="card-header p-2 border-0">
                <ul class="nav nav-pills nav-justified bg-surface rounded-pill p-1" id="authTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active rounded-pill" href="{{ url_for('auth.login') }}">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link rounded-pill" href="{{ url_for('auth.register') }}">Register</a>
                    </li>
                </ul>
            </div>

            <div class="card-body p-4">
                <h3 class="card-title mb-4">Login</h3>
                <form action="" method="post" novalidate id="loginForm">
                    {{ form.hidden_tag() }}
                    
                    <!-- Hidden actual role field synced by JS -->
                    {{ form.role(id="actual-role-field", class="d-none") }}

                    <div class="mb-3">
                        {{ form.email.label(class="form-label") }}
                        {{ form.email(class="form-control", placeholder="Enter your email") }}
                        {% for error in form.email.errors %}
                        <span class="text-danger">[{{ error }}]</span>
                        {% endfor %}
                    </div>
                    <div class="mb-3">
                        {{ form.password.label(class="form-label") }}
                        <div class="input-group">
                            {{ form.password(class="form-control", placeholder="Enter your password", id="password-field") }}
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('password-field')">
                                <span data-feather="eye"></span>
                            </button>
                        </div>
                        {% for error in form.password.errors %}
                        <span class="text-danger">[{{ error }}]</span>
                        {% endfor %}
                    </div>
                    <div class="mb-3 form-check">
                        {{ form.remember_me(class="form-check-input") }}
                        {{ form.remember_me.label(class="form-check-label") }}
                    </div>
                    <div class="d-grid">
                        {{ form.submit(class="btn btn-primary") }}
                    </div>

                    <div class="text-center my-3 text-muted small">OR</div>

                    <div class="d-grid gap-2">
                        <a href="{{ url_for('auth.oauth_login', provider='google') }}" class="btn btn-outline-secondary border-glass d-flex align-items-center justify-content-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-google me-2" viewBox="0 0 16 16">
                                <path d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352-2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z"/>
                            </svg>
                            Sign in with Google
                        </a>
                        <a href="{{ url_for('auth.oauth_login', provider='linkedin') }}" class="btn btn-outline-secondary border-glass d-flex align-items-center justify-content-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-linkedin me-2" viewBox="0 0 16 16">
                                <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.358 1.248zM6.169 14.854H8.57v-3.953c0-.218.042-.437.157-.597.345-.515 1.129-.627 1.403-.627.991 0 1.403.749 1.403 2.19v2.987h2.401v-4.22c0-2.261-1.206-3.313-2.813-3.313-1.312 0-1.896.729-2.217 1.237h.023v-1.066H6.169v7.369z"/>
                            </svg>
                            Sign in with LinkedIn
                        </a>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    field.type = field.type === 'password' ? 'text' : 'password';
}

function syncRole(role) {
    document.getElementById('actual-role-field').value = role;
}

// Initial sync on load
document.addEventListener('DOMContentLoaded', () => {
    syncRole('user');
});
</script>
{% endblock %}