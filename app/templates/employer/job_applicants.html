{% extends "base.html" %}

{% block title %}Applicants: {{ job.title }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-5 animate-up">
        <div>
            <h6 class="text-primary text-uppercase mb-1">Candidate Pool</h6>
            <h1 class="display-5 fw-bold text-main">{{ job.title }}</h1>
        </div>
        <a href="{{ url_for('employer.manage_jobs') }}" class="btn btn-outline-secondary">Back to Jobs</a>
    </div>

    {% if applicant_data %}
    <div class="row g-4">
        {% for item in applicant_data %}
        <div class="col-md-6 col-xl-4 animate-up" style="animation-delay: {{ loop.index * 100 }}ms;">
            <div class="card border-glass h-100 hover-lift">
                <div class="card-header bg-transparent border-glass d-flex justify-content-between align-items-center">
                    <span class="badge bg-secondary bg-opacity-25 text-main">{{ item.application.applied_at.strftime('%b
                        %d') }}</span>
                    {% set status_colors = {'submitted': 'primary', 'shortlisted': 'info', 'interviewing': 'warning',
                    'rejected': 'danger', 'hired': 'success'} %}
                    <span class="badge bg-{{ status_colors.get(item.application.status, 'secondary') }}">{{
                        item.application.status.title() }}</span>
                </div>

                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center me-3"
                            style="width: 48px; height: 48px;">
                            <span class="fw-bold text-primary">{{ item.user.username[:2].upper() }}</span>
                        </div>
                        <div>
                            <h5 class="card-title mb-0 fw-bold">{{ item.user.username }}</h5>
                            <small class="text-muted">{{ item.user.email }}</small>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="small text-muted fw-bold text-uppercase">Match Score</label>
                        <div class="progress mt-1" style="height: 6px;">
                            <div class="progress-bar bg-{{ 'success' if item.score >= 70 else 'warning' if item.score >= 40 else 'danger' }}"
                                role="progressbar" style="width: {{ item.score if item.score != 'N/A' else 0 }}%"></div>
                        </div>
                        <div class="d-flex justify-content-end mt-1">
                            <span class="small fw-bold text-main">{{ item.score }}%</span>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <a href="{{ url_for('employer.candidate_profile', user_id=item.user.id) }}"
                            class="btn btn-outline-primary">
                            <span data-feather="user" class="me-2"></span> View Profile
                        </a>
                        {% if item.application.resume_path %}
                        <a href="{{ url_for('user.uploaded_file', filename=item.application.resume_path) }}"
                            class="btn btn-outline-secondary" target="_blank">
                            <span data-feather="file-text" class="me-2"></span> View Resume
                        </a>
                        {% endif %}
                    </div>
                </div>

                <div class="card-footer bg-transparent border-glass">
                    <div class="dropdown w-100">
                        <button class="btn btn-sm btn-secondary w-100 dropdown-toggle" type="button"
                            data-bs-toggle="dropdown">
                            Change Status
                        </button>
                        <ul class="dropdown-menu w-100">
                            <li><a class="dropdown-item"
                                    href="{{ url_for('employer.update_application_status', app_id=item.application.id, status='shortlisted') }}">Shortlist</a>
                            </li>
                            <li><a class="dropdown-item"
                                    href="{{ url_for('employer.update_application_status', app_id=item.application.id, status='interviewing') }}">Interview</a>
                            </li>
                            <li><a class="dropdown-item text-success"
                                    href="{{ url_for('employer.update_application_status', app_id=item.application.id, status='hired') }}">Hire</a>
                            </li>
                            <li>
                                <hr class="dropdown-divider border-glass">
                            </li>
                            <li><a class="dropdown-item text-danger"
                                    href="{{ url_for('employer.update_application_status', app_id=item.application.id, status='rejected') }}">Reject</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5 animate-up">
        <div class="mb-3 text-muted opacity-50">
            <span data-feather="users" style="width: 64px; height: 64px;"></span>
        </div>
        <h3 class="text-muted">No Applicants Yet</h3>
        <p class="text-muted">Share your job posting to attract talent.</p>
    </div>
    {% endif %}
</div>
{% endblock %}